<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>从零构造现代语言编译器(7): Parse优先级 | CanftIn's Blog</title><meta name=keywords content><meta name=description content="表达式 目录 表达式 目录 概述 优先级 名称 非限定名称 限定名称和成员访问 操作符 转换和类型转换 if 表达式 数值类型文字表达式 考虑的替代方案 参考文献 概述 表达式"><meta name=author content="矩木"><link rel=canonical href=https://canftin.github.io/posts/tech/p8_compiler_build_7_parse_precedence/><link crossorigin=anonymous href=/assets/css/stylesheet.a82955faa917eb088598a3f91ac57597187a910fe8499e3b1c922d4f9cbe56b2.css integrity="sha256-qClV+qkX6wiFmKP5GsV1lxh6kQ/oSZ47HJItT5y+VrI=" rel="preload stylesheet" as=style><link rel=icon href=https://canftin.github.io/img/text_icon.ico><link rel=icon type=image/png sizes=16x16 href=https://canftin.github.io/img/text_icon.ico><link rel=icon type=image/png sizes=32x32 href=https://canftin.github.io/img/text_icon.ico><link rel=apple-touch-icon href=https://canftin.github.io/text_icon.ico><link rel=mask-icon href=https://canftin.github.io/text_icon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer src=https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script>
<script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="从零构造现代语言编译器(7): Parse优先级"><meta property="og:description" content="表达式 目录 表达式 目录 概述 优先级 名称 非限定名称 限定名称和成员访问 操作符 转换和类型转换 if 表达式 数值类型文字表达式 考虑的替代方案 参考文献 概述 表达式"><meta property="og:type" content="article"><meta property="og:url" content="https://canftin.github.io/posts/tech/p8_compiler_build_7_parse_precedence/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-03T11:20:53+08:00"><meta property="article:modified_time" content="2023-10-03T11:20:53+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="从零构造现代语言编译器(7): Parse优先级"><meta name=twitter:description content="表达式 目录 表达式 目录 概述 优先级 名称 非限定名称 限定名称和成员访问 操作符 转换和类型转换 if 表达式 数值类型文字表达式 考虑的替代方案 参考文献 概述 表达式"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"所有文章","item":"https://canftin.github.io/posts/"},{"@type":"ListItem","position":2,"name":"技术","item":"https://canftin.github.io/posts/tech/"},{"@type":"ListItem","position":3,"name":"从零构造现代语言编译器(7): Parse优先级","item":"https://canftin.github.io/posts/tech/p8_compiler_build_7_parse_precedence/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"从零构造现代语言编译器(7): Parse优先级","name":"从零构造现代语言编译器(7): Parse优先级","description":"表达式 目录 表达式 目录 概述 优先级 名称 非限定名称 限定名称和成员访问 操作符 转换和类型转换 if 表达式 数值类型文字表达式 考虑的替代方案 参考文献 概述 表达式","keywords":[""],"articleBody":"表达式 目录 表达式 目录 概述 优先级 名称 非限定名称 限定名称和成员访问 操作符 转换和类型转换 if 表达式 数值类型文字表达式 考虑的替代方案 参考文献 概述 表达式是 Carbon 语法中产生值的部分。因为在 Carbon 中，类型是值，所以这包括指定类型的任何地方。\n1 2 3 fn Foo(a: i32*) -\u003e i32 { return *a; } 这里，参数类型 i32*、返回类型 i32 和 return 语句的操作数 *a 都是表达式。\n优先级 表达式基于部分优先级排序进行解释。 缺少相对排序的表达式组件必须由开发者进行消歧，例如通过添加括号；否则，由于模糊性，表达式将无效。 只有当大多数开发者在没有括号的情况下都能理解优先级时，才会添加优先级排序。\n优先级图定义如下：\n1 ... (此处省略了图的内容，因为它是图形内容，不适合文字翻译) 图的属性包括：\n每个非空节点代表一个优先级组。空圈用于简化图形，并不代表优先级组。\n当一个表达式由不同的优先级组组成时，解释由优先级边确定：\n优先级边 A –\u003e B 表示 A 的优先级低于 B，所以 A 可以不用括号包含 B。例如，or --\u003e not 表示 not x or y 被视为 (not x) or y。\n优先级边是传递的。例如，or --\u003e == --\u003e as 表示 or 的优先级低于 as。\n当一个二元操作符表达式由单个优先级组组成时，解释由优先级组的结合性确定：\n1 2 3 graph TD non[\"非结合性\"] left[\"左结合性\"] 例如，+ 和 - 是左结合的，并且在同一个优先级组中，所以 a + b + c - d 被视为 ((a + b) + c) - d。\n注意，在 Carbon 中，我们目前只有左结合操作符。与 C++ 和其他语言不同，赋值不是右结合操作符，它使用自己的语句。\n当一个一元操作符表达式由单个优先级组组成时，它可以允许不带括号的重复或不允许：\n1 2 3 graph TD non[\"非重复\"] repeating[\"重复\"] 这与二元操作符的结合性类似。\n名称 非限定名称 非限定名称 是一个单词，它不是关键字，并且前面没有句点(.)。\n待办事项: 非限定名称的名称查找规则。\n限定名称和成员访问 限定名称 是一个单词，它紧跟在句点或向右的箭头后面。限定名称出现在以下上下文中：\n指定符：. 单词 简单成员访问表达式：表达式 . 单词 简单指针成员访问表达式：表达式 -\u003e 单词 1 2 3 4 5 6 7 8 9 10 11 var x: auto = {.hello = 1, .world = 2}; ^^^^^ ^^^^^ 限定名称 ^^^^^^ ^^^^^^ 指定符 x.hello = x.world; ^^^^^ ^^^^^ 限定名称 ^^^^^^^ ^^^^^^^ 成员访问表达式 x.hello = (\u0026x)-\u003eworld; ^^^^^ 限定名称 ^^^^^^^^^^^ 指针成员访问表达式 限定名称引用由表达式出现的上下文确定的实体的成员。对于成员访问，实体由句点前的表达式命名。在结构字面量中，实体是结构类型。例如：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 package Foo api; namespace N; fn N.F() {} fn G() { // 与 `(Foo.N).F()` 相同。 // `Foo.N` 命名包 `Foo` 中的命名空间 `N`。 // `(Foo.N).F` 命名命名空间 ` N` 中的函数 `F`。 Foo.N.F(); } // `.n` 引用 `{.n: i32}` 的成员 `n`。 fn H(a: {.n: i32}) -\u003e i32 { // `a.n` 解析为成员 `{.n: i32}.n`， // 并命名 `a` 的相应子对象。 return a.n; } fn J() { // `.n` 引用 `{.n: i32}` 的成员 `n`。 H({.n = 5 as i32}); } 成员访问表达式从左到右关联。如果成员名称比单个 单词 更复杂，可以使用带有括号的成员名称的复合成员访问表达式：\n表达式 . ( 表达式 ) 表达式 -\u003e ( 表达式 ) 1 2 3 4 5 6 interface I { fn F[self: Self](); } class X {} impl X as I { fn F[self: Self]() {} } // `x.I.F()` 将意味着 `(x.I).F()`。 fn Q(x: X) { x.(I.F)(); } 简单或复合成员访问可以是 指针 成员访问表达式的一部分，当使用 -\u003e 而不是 . 时，其中 表达式 -\u003e … 是 ( * 表达式 ) . … 的语法糖。\n操作符 大多数表达式都被建模为操作符：\n类别 操作符 语法 功能 指针 * (一元) *x 指针解引用：由 x 指向的对象。 指针 \u0026 (一元) \u0026x 地址：指向对象 x 的指针。 算术 - (一元) -x x 的负数。 位运算 ^ (一元) ^x x 的位补数。 算术 + x + y x 和 y 的和。 算术 - (二元) x - y x 和 y 的差。 算术 * x * y x 和 y 的乘积。 算术 / x / y x 除以 y，或其商。 算术 % x % y x 对 y 的模。 位运算 \u0026 x \u0026 y x 和 y 的位与。 位运算 | x | y x 和 y 的位或。 位运算 ^ (二元) x ^ y x 和 y 的位异或。 位运算 \u003c\u003c x \u003c\u003c y x 左移 y 位。 位运算 \u003e\u003e x \u003e\u003e y x 右移 y 位。 转换 as x as T 将值 x 转换为类型 T。 比较 == x == y 相等：如果 x 等于 y，则为 true。 比较 != x != y 不等：如果 x 不等于 y，则为 true。 比较 \u003c x \u003c y 小于：如果 x 小于 y，则为 true。 比较 \u003c= x \u003c= y 小于或等于：如果 x 小于或等于 y，则为 true。 比较 \u003e x \u003e y 大于：如果 x 大于 y，则为 true。 比较 \u003e= x \u003e= y 大于或等于：如果 x 大于或等于 y ，则为 true。 | | 逻辑 | and | x and y | 短路逻辑与：如果两个操作数都为 true，则为 true。 | | 逻辑 | or | x or y | 短路逻辑或：如果任一操作数为 true，则为 true。 | | 逻辑 | not | not x | 逻辑非：如果操作数为 false，则为 true。 |\n二元算术和位运算操作符还有复合赋值形式。这些是语句而不是表达式，并且不产生值。\n转换和类型转换 当表达式出现在需要特定类型的表达式的上下文中时，将应用隐式转换将表达式转换为目标类型。\n表达式也可以使用as 表达式转换为特定类型。\n1 2 3 4 5 fn Bar(n: i32); fn Baz(n: i64) { // OK，与 Bar(n as i32) 相同 Bar(n); } if 表达式 if 表达式在两个表达式之间进行选择。\n1 2 3 fn Run(args: Span(StringView)) { var file: StringView = if args.size() \u003e 1 then args[1] else \"/dev/stdin\"; } if 表达式与 C 和 C++ 中的 ?: 三元表达式类似。\n数值类型文字表达式 Carbon 的语法提供了一种简单的方法来表示不同类型的整数和浮点数。每种类型都用类似关键字的语法标识，前缀为 i、u 或 f，后跟 8 的倍数，表示数据类型的位大小。\n这些被称为数值类型文字。\n考虑的替代方案 其他表达式文档将列出更多的替代方案；此处列出的替代方案在其他地方没有提及。\n总顺序 不同操作数的不同优先级 要求少于部分顺序 参考文献 其他表达式文档将列出更多的参考文献；此处列出的参考文献在其他地方没有提及。\n提案 #555: 操作符优先级。 这是使用 markdown 输出格式的中文全文翻译。您还想知道什么？\n%%{init: {'themeVariables': {'fontFamily': 'monospace'}}}%% graph BT parens[\"(...)\"] braces[\"{...}\"] click braces \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/classes.md#literals\" unqualifiedName[\"x\"] click unqualifiedName \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/README.md#unqualified-names\" top((\" \")) memberAccess\u003e\"x.y\nx.(...)\nx-\u003ey\nx-\u003e(...)\"] click memberAccess \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/member_access.md\" constType[\"const T\"] click pointer-type \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/type_operators.md\" pointerType{\"T*\"} click pointer-type \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/type_operators.md\" pointer{\"*x\n\u0026x\n\"} click pointer \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/pointer.md\" negation[\"-x\"] click negation \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/arithmetic.md\" complement[\"^x\"] click complement \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/bitwise.md\" incDec[\"++x;\n--x;\"] click incDec \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/assignment.md\" unary((\" \")) as[\"x as T\"] click as \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/implicit_conversions.md\" multiplication\u003e\"x * y\nx / y\"] click multiplication \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/arithmetic.md\" addition\u003e\"x + y\nx - y\"] click addition \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/arithmetic.md\" modulo[\"x % y\"] click modulo \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/arithmetic.md\" bitwise_and\u003e\"x \u0026 y\"] bitwise_or\u003e\"x | y\"] bitwise_xor\u003e\"x ^ y\"] click bitwise_and \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/bitwise.md\" click bitwise_or \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/bitwise.md\" click bitwise_xor \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/bitwise.md\" shift[\"x \u003c\u003c y\nx \u003e\u003e y\"] click shift \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/bitwise.md\" comparison[\"x == y\nx != y\nx \u003c y\nx \u003c= y\nx \u003e y\nx \u003e= y\"] click comparison \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/comparison_operators.md\" not[\"not x\"] click not \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/logical_operators.md\" logicalOperand((\" \")) and\u003e\"x and y\"] click and \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/logical_operators.md\" or\u003e\"x or y\"] click or \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/logical_operators.md\" logicalExpression((\" \")) if\u003e\"if x then y else z\"] click if \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/if.md\" insideParens[\"(...)\"] assignment[\"x = y;\nx $= y;\"] click assignment \"https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/assignment.md\" expressionStatement[\"x;\"] top --\u003e parens \u0026 braces \u0026 unqualifiedName constType --\u003e top pointerType --\u003e constType as --\u003e pointerType memberAccess --\u003e top pointer --\u003e memberAccess negation \u0026 complement \u0026 incDec --\u003e pointer unary --\u003e negation \u0026 complement %% Use a longer arrow here to put `not` next to `and` and `or`. not -------\u003e memberAccess as \u0026 multiplication \u0026 modulo \u0026 bitwise_and \u0026 bitwise_or \u0026 bitwise_xor \u0026 shift --\u003e unary addition --\u003e multiplication comparison --\u003e as \u0026 addition \u0026 modulo \u0026 bitwise_and \u0026 bitwise_or \u0026 bitwise_xor \u0026 shift logicalOperand --\u003e comparison \u0026 not and \u0026 or --\u003e logicalOperand logicalExpression --\u003e and \u0026 or if \u0026 expressionStatement --\u003e logicalExpression insideParens \u0026 assignment --\u003e if ","wordCount":"2549","inLanguage":"en","datePublished":"2023-10-03T11:20:53+08:00","dateModified":"2023-10-03T11:20:53+08:00","author":[{"@type":"Person","name":"矩木"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://canftin.github.io/posts/tech/p8_compiler_build_7_parse_precedence/"},"publisher":{"@type":"Organization","name":"CanftIn's Blog","logo":{"@type":"ImageObject","url":"https://canftin.github.io/img/text_icon.ico"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://canftin.github.io/ accesskey=h title="CanftIn's Blog (Alt + H)">CanftIn's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://canftin.github.io/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://canftin.github.io/ title=主页><span>主页</span></a></li><li><a href=https://canftin.github.io/posts title=文章><span>文章</span></a></li><li><a href=https://canftin.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://canftin.github.io/tags title=标签><span>标签</span></a></li><li><a href=https://canftin.github.io/about title=关于><span>关于</span></a></li></ul></nav></header><main class="main page"><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://canftin.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://canftin.github.io/posts/>所有文章</a>&nbsp;»&nbsp;<a href=https://canftin.github.io/posts/tech/>技术</a></div><h1 class=post-title>从零构造现代语言编译器(7): Parse优先级</h1><div class=post-meta><span title='2023-10-03 11:20:53 +0800 CST'>2023-10-03</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;矩木<span style=opacity:.8>
<span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;</span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e8%a1%a8%e8%be%be%e5%bc%8f aria-label=表达式>表达式</a><ul><li><a href=#%e7%9b%ae%e5%bd%95 aria-label=目录>目录</a></li><li><a href=#%e6%a6%82%e8%bf%b0 aria-label=概述>概述</a></li><li><a href=#%e4%bc%98%e5%85%88%e7%ba%a7 aria-label=优先级>优先级</a></li><li><a href=#%e5%90%8d%e7%a7%b0 aria-label=名称>名称</a><ul><li><a href=#%e9%9d%9e%e9%99%90%e5%ae%9a%e5%90%8d%e7%a7%b0 aria-label=非限定名称>非限定名称</a></li><li><a href=#%e9%99%90%e5%ae%9a%e5%90%8d%e7%a7%b0%e5%92%8c%e6%88%90%e5%91%98%e8%ae%bf%e9%97%ae aria-label=限定名称和成员访问>限定名称和成员访问</a></li></ul></li><li><a href=#%e6%93%8d%e4%bd%9c%e7%ac%a6 aria-label=操作符>操作符</a></li><li><a href=#%e8%bd%ac%e6%8d%a2%e5%92%8c%e7%b1%bb%e5%9e%8b%e8%bd%ac%e6%8d%a2 aria-label=转换和类型转换>转换和类型转换</a></li><li><a href=#if-%e8%a1%a8%e8%be%be%e5%bc%8f aria-label="if 表达式"><code>if</code> 表达式</a></li><li><a href=#%e6%95%b0%e5%80%bc%e7%b1%bb%e5%9e%8b%e6%96%87%e5%ad%97%e8%a1%a8%e8%be%be%e5%bc%8f aria-label=数值类型文字表达式>数值类型文字表达式</a></li><li><a href=#%e8%80%83%e8%99%91%e7%9a%84%e6%9b%bf%e4%bb%a3%e6%96%b9%e6%a1%88 aria-label=考虑的替代方案>考虑的替代方案</a></li><li><a href=#%e5%8f%82%e8%80%83%e6%96%87%e7%8c%ae aria-label=参考文献>参考文献</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{elements&&(activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")}))},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=表达式>表达式<a hidden class=anchor aria-hidden=true href=#表达式>#</a></h1><h2 id=目录>目录<a hidden class=anchor aria-hidden=true href=#目录>#</a></h2><ul><li><a href=#%E8%A1%A8%E8%BE%BE%E5%BC%8F>表达式</a><ul><li><a href=#%E7%9B%AE%E5%BD%95>目录</a></li><li><a href=#%E6%A6%82%E8%BF%B0>概述</a></li><li><a href=#%E4%BC%98%E5%85%88%E7%BA%A7>优先级</a></li><li><a href=#%E5%90%8D%E7%A7%B0>名称</a><ul><li><a href=#%E9%9D%9E%E9%99%90%E5%AE%9A%E5%90%8D%E7%A7%B0>非限定名称</a></li><li><a href=#%E9%99%90%E5%AE%9A%E5%90%8D%E7%A7%B0%E5%92%8C%E6%88%90%E5%91%98%E8%AE%BF%E9%97%AE>限定名称和成员访问</a></li></ul></li><li><a href=#%E6%93%8D%E4%BD%9C%E7%AC%A6>操作符</a></li><li><a href=#%E8%BD%AC%E6%8D%A2%E5%92%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2>转换和类型转换</a></li><li><a href=#if-%E8%A1%A8%E8%BE%BE%E5%BC%8F><code>if</code> 表达式</a></li><li><a href=#%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B%E6%96%87%E5%AD%97%E8%A1%A8%E8%BE%BE%E5%BC%8F>数值类型文字表达式</a></li><li><a href=#%E8%80%83%E8%99%91%E7%9A%84%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88>考虑的替代方案</a></li><li><a href=#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE>参考文献</a></li></ul></li></ul><h2 id=概述>概述<a hidden class=anchor aria-hidden=true href=#概述>#</a></h2><p>表达式是 Carbon 语法中产生值的部分。因为在 Carbon 中，类型是值，所以这包括指定类型的任何地方。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>fn Foo(a: i32*) -&gt; i32 {
</span></span><span style=display:flex><span>  return *a;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>这里，参数类型 <code>i32*</code>、返回类型 <code>i32</code> 和 <code>return</code> 语句的操作数 <code>*a</code> 都是表达式。</p><h2 id=优先级>优先级<a hidden class=anchor aria-hidden=true href=#优先级>#</a></h2><p>表达式基于部分<a href=https://en.wikipedia.org/wiki/Order_of_operations>优先级排序</a>进行解释。
缺少相对排序的表达式组件必须由开发者进行消歧，例如通过添加括号；否则，由于模糊性，表达式将无效。
只有当大多数开发者在没有括号的情况下都能理解优先级时，才会添加优先级排序。</p><p>优先级图定义如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>... (此处省略了图的内容，因为它是图形内容，不适合文字翻译)
</span></span></code></pre></td></tr></table></div></div><p>图的属性包括：</p><ul><li><p>每个非空节点代表一个优先级组。空圈用于简化图形，并不代表优先级组。</p></li><li><p>当一个表达式由不同的优先级组组成时，解释由优先级边确定：</p><ul><li><p>优先级边 A &ndash;> B 表示 A 的优先级低于 B，所以 A 可以不用括号包含 B。例如，<code>or --> not</code> 表示 <code>not x or y</code> 被视为 <code>(not x) or y</code>。</p></li><li><p>优先级边是传递的。例如，<code>or --> == --> as</code> 表示 <code>or</code> 的优先级低于 <code>as</code>。</p></li></ul></li><li><p>当一个二元操作符表达式由单个优先级组组成时，解释由优先级组的<a href=https://en.wikipedia.org/wiki/Operator_associativity>结合性</a>确定：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>graph TD
</span></span><span style=display:flex><span>    non[&#34;非结合性&#34;]
</span></span><span style=display:flex><span>    left[&#34;左结合性&#34;]
</span></span></code></pre></td></tr></table></div></div><ul><li><p>例如，<code>+</code> 和 <code>-</code> 是左结合的，并且在同一个优先级组中，所以 <code>a + b + c - d</code> 被视为 <code>((a + b) + c) - d</code>。</p></li><li><p>注意，在 Carbon 中，我们目前只有左结合操作符。与 C++ 和其他语言不同，<a href=/docs/design/assignment.md>赋值</a>不是右结合操作符，它使用自己的语句。</p></li></ul></li><li><p>当一个一元操作符表达式由单个优先级组组成时，它可以允许不带括号的重复或不允许：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>graph TD
</span></span><span style=display:flex><span>    non[&#34;非重复&#34;]
</span></span><span style=display:flex><span>    repeating[&#34;重复&#34;]
</span></span></code></pre></td></tr></table></div></div><p>这与二元操作符的结合性类似。</p></li></ul><h2 id=名称>名称<a hidden class=anchor aria-hidden=true href=#名称>#</a></h2><h3 id=非限定名称>非限定名称<a hidden class=anchor aria-hidden=true href=#非限定名称>#</a></h3><p><em>非限定名称</em> 是一个<a href=../lexical_conventions/words.md>单词</a>，它不是关键字，并且前面没有句点(<code>.</code>)。</p><p><strong>待办事项:</strong> 非限定名称的名称查找规则。</p><h3 id=限定名称和成员访问>限定名称和成员访问<a hidden class=anchor aria-hidden=true href=#限定名称和成员访问>#</a></h3><p><em>限定名称</em> 是一个单词，它紧跟在句点或向右的箭头后面。限定名称出现在以下上下文中：</p><ul><li><a href=/docs/design/classes.md#literals>指定符</a>：<code>.</code> <em>单词</em></li><li><a href=member_access.md>简单成员访问表达式</a>：<em>表达式</em> <code>.</code> <em>单词</em></li><li><a href=member_access.md>简单指针成员访问表达式</a>：<em>表达式</em> <code>-></code> <em>单词</em></li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>var x: auto = {.hello = 1, .world = 2};
</span></span><span style=display:flex><span>                ^^^^^       ^^^^^ 限定名称
</span></span><span style=display:flex><span>               ^^^^^^      ^^^^^^ 指定符
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>x.hello = x.world;
</span></span><span style=display:flex><span>  ^^^^^     ^^^^^ 限定名称
</span></span><span style=display:flex><span>^^^^^^^   ^^^^^^^ 成员访问表达式
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>x.hello = (&amp;x)-&gt;world;
</span></span><span style=display:flex><span>                ^^^^^ 限定名称
</span></span><span style=display:flex><span>          ^^^^^^^^^^^ 指针成员访问表达式
</span></span></code></pre></td></tr></table></div></div><p>限定名称引用由表达式出现的上下文确定的实体的成员。对于成员访问，实体由句点前的表达式命名。在结构字面量中，实体是结构类型。例如：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>package Foo api;
</span></span><span style=display:flex><span>namespace N;
</span></span><span style=display:flex><span>fn N.<span style=color:#a6e22e>F</span>() <span style=color:#960050;background-color:#1e0010>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fn <span style=color:#a6e22e>G</span>() <span style=color:#960050;background-color:#1e0010>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>//</span> <span style=color:#960050;background-color:#1e0010>与</span> <span style=color:#f92672>`</span>(Foo.N).<span style=color:#a6e22e>F</span>()<span style=color:#f92672>`</span> <span style=color:#960050;background-color:#1e0010>相同。</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>//</span> <span style=color:#f92672>`</span>Foo.N<span style=color:#f92672>`</span> <span style=color:#960050;background-color:#1e0010>命名包</span> <span style=color:#f92672>`</span>Foo<span style=color:#f92672>`</span> <span style=color:#960050;background-color:#1e0010>中的命名空间</span> <span style=color:#f92672>`</span>N<span style=color:#f92672>`</span><span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>//</span> <span style=color:#f92672>`</span>(Foo.N).F<span style=color:#f92672>`</span> <span style=color:#960050;background-color:#1e0010>命名命名空间</span> <span style=color:#f92672>`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>N<span style=color:#f92672>`</span> <span style=color:#960050;background-color:#1e0010>中的函数</span> <span style=color:#f92672>`</span>F<span style=color:#f92672>`</span><span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span>  Foo.N.<span style=color:#a6e22e>F</span>();
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>//</span> <span style=color:#f92672>`</span>.n<span style=color:#f92672>`</span> <span style=color:#960050;background-color:#1e0010>引用</span> <span style=color:#f92672>`</span><span style=color:#960050;background-color:#1e0010>{</span>.n: i32<span style=color:#960050;background-color:#1e0010>}</span><span style=color:#f92672>`</span> <span style=color:#960050;background-color:#1e0010>的成员</span> <span style=color:#f92672>`</span>n<span style=color:#f92672>`</span><span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span>fn <span style=color:#a6e22e>H</span>(a: <span style=color:#960050;background-color:#1e0010>{</span>.n: i32<span style=color:#960050;background-color:#1e0010>}</span>) <span style=color:#f92672>-&gt;</span> i32 <span style=color:#960050;background-color:#1e0010>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>//</span> <span style=color:#f92672>`</span>a.n<span style=color:#f92672>`</span> <span style=color:#960050;background-color:#1e0010>解析为成员</span> <span style=color:#f92672>`</span><span style=color:#960050;background-color:#1e0010>{</span>.n: i32<span style=color:#960050;background-color:#1e0010>}</span>.n<span style=color:#f92672>`</span><span style=color:#960050;background-color:#1e0010>，</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>//</span> <span style=color:#960050;background-color:#1e0010>并命名</span> <span style=color:#f92672>`</span>a<span style=color:#f92672>`</span> <span style=color:#960050;background-color:#1e0010>的相应子对象。</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> a.n;
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fn <span style=color:#a6e22e>J</span>() <span style=color:#960050;background-color:#1e0010>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>//</span> <span style=color:#f92672>`</span>.n<span style=color:#f92672>`</span> <span style=color:#960050;background-color:#1e0010>引用</span> <span style=color:#f92672>`</span><span style=color:#960050;background-color:#1e0010>{</span>.n: i32<span style=color:#960050;background-color:#1e0010>}</span><span style=color:#f92672>`</span> <span style=color:#960050;background-color:#1e0010>的成员</span> <span style=color:#f92672>`</span>n<span style=color:#f92672>`</span><span style=color:#960050;background-color:#1e0010>。</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>H</span>(<span style=color:#960050;background-color:#1e0010>{</span>.n <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span> <span style=color:#66d9ef>as</span> i32<span style=color:#960050;background-color:#1e0010>}</span>);
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span></code></pre></td></tr></table></div></div><p>成员访问表达式从左到右关联。如果成员名称比单个 <em>单词</em> 更复杂，可以使用带有括号的成员名称的复合成员访问表达式：</p><ul><li><em>表达式</em> <code>.</code> <code>(</code> <em>表达式</em> <code>)</code></li><li><em>表达式</em> <code>-></code> <code>(</code> <em>表达式</em> <code>)</code></li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>interface I { fn F[self: Self](); }
</span></span><span style=display:flex><span>class X {}
</span></span><span style=display:flex><span>impl X as I { fn F[self: Self]() {} }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// `x.I.F()` 将意味着 `(x.I).F()`。
</span></span><span style=display:flex><span>fn Q(x: X) { x.(I.F)(); }
</span></span></code></pre></td></tr></table></div></div><p>简单或复合成员访问可以是 <em>指针</em> 成员访问表达式的一部分，当使用 <code>-></code> 而不是 <code>.</code> 时，其中 <em>表达式</em> <code>-></code> <em>&mldr;</em> 是 <code>(</code> <code>*</code> <em>表达式</em> <code>)</code> <code>.</code> <em>&mldr;</em> 的语法糖。</p><h2 id=操作符>操作符<a hidden class=anchor aria-hidden=true href=#操作符>#</a></h2><p>大多数表达式都被建模为操作符：</p><table><thead><tr><th>类别</th><th>操作符</th><th>语法</th><th>功能</th></tr></thead><tbody><tr><td>指针</td><td><a href=pointer_operators.md><code>*</code></a> (一元)</td><td><code>*x</code></td><td>指针解引用：由 <code>x</code> 指向的对象。</td></tr><tr><td>指针</td><td><a href=pointer_operators.md><code>&</code></a> (一元)</td><td><code>&amp;x</code></td><td>地址：指向对象 <code>x</code> 的指针。</td></tr><tr><td>算术</td><td><a href=arithmetic.md><code>-</code></a> (一元)</td><td><code>-x</code></td><td><code>x</code> 的负数。</td></tr><tr><td>位运算</td><td><a href=bitwise.md><code>^</code></a> (一元)</td><td><code>^x</code></td><td><code>x</code> 的位补数。</td></tr><tr><td>算术</td><td><a href=arithmetic.md><code>+</code></a></td><td><code>x + y</code></td><td><code>x</code> 和 <code>y</code> 的和。</td></tr><tr><td>算术</td><td><a href=arithmetic.md><code>-</code></a> (二元)</td><td><code>x - y</code></td><td><code>x</code> 和 <code>y</code> 的差。</td></tr><tr><td>算术</td><td><a href=arithmetic.md><code>*</code></a></td><td><code>x * y</code></td><td><code>x</code> 和 <code>y</code> 的乘积。</td></tr><tr><td>算术</td><td><a href=arithmetic.md><code>/</code></a></td><td><code>x / y</code></td><td><code>x</code> 除以 <code>y</code>，或其商。</td></tr><tr><td>算术</td><td><a href=arithmetic.md><code>%</code></a></td><td><code>x % y</code></td><td><code>x</code> 对 <code>y</code> 的模。</td></tr><tr><td>位运算</td><td><a href=bitwise.md><code>&</code></a></td><td><code>x & y</code></td><td><code>x</code> 和 <code>y</code> 的位与。</td></tr><tr><td>位运算</td><td><a href=bitwise.md><code>|</code></a></td><td><code>x | y</code></td><td><code>x</code> 和 <code>y</code> 的位或。</td></tr><tr><td>位运算</td><td><a href=bitwise.md><code>^</code></a> (二元)</td><td><code>x ^ y</code></td><td><code>x</code> 和 <code>y</code> 的位异或。</td></tr><tr><td>位运算</td><td><a href=bitwise.md><code>&lt;&lt;</code></a></td><td><code>x &lt;&lt; y</code></td><td><code>x</code> 左移 <code>y</code> 位。</td></tr><tr><td>位运算</td><td><a href=bitwise.md><code>>></code></a></td><td><code>x >> y</code></td><td><code>x</code> 右移 <code>y</code> 位。</td></tr><tr><td>转换</td><td><a href=as_expressions.md><code>as</code></a></td><td><code>x as T</code></td><td>将值 <code>x</code> 转换为类型 <code>T</code>。</td></tr><tr><td>比较</td><td><a href=comparison_operators.md><code>==</code></a></td><td><code>x == y</code></td><td>相等：如果 <code>x</code> 等于 <code>y</code>，则为 <code>true</code>。</td></tr><tr><td>比较</td><td><a href=comparison_operators.md><code>!=</code></a></td><td><code>x != y</code></td><td>不等：如果 <code>x</code> 不等于 <code>y</code>，则为 <code>true</code>。</td></tr><tr><td>比较</td><td><a href=comparison_operators.md><code>&lt;</code></a></td><td><code>x &lt; y</code></td><td>小于：如果 <code>x</code> 小于 <code>y</code>，则为 <code>true</code>。</td></tr><tr><td>比较</td><td><a href=comparison_operators.md><code>&lt;=</code></a></td><td><code>x &lt;= y</code></td><td>小于或等于：如果 <code>x</code> 小于或等于 <code>y</code>，则为 <code>true</code>。</td></tr><tr><td>比较</td><td><a href=comparison_operators.md><code>></code></a></td><td><code>x > y</code></td><td>大于：如果 <code>x</code> 大于 <code>y</code>，则为 <code>true</code>。</td></tr><tr><td>比较</td><td><a href=comparison_operators.md><code>>=</code></a></td><td><code>x >= y</code></td><td>大于或等于：如果 <code>x</code> 大于或等于 <code>y</code></td></tr></tbody></table><p>，则为 <code>true</code>。 |
| 逻辑 | <a href=logical_operators.md><code>and</code></a> | <code>x and y</code> | 短路逻辑与：如果两个操作数都为 <code>true</code>，则为 <code>true</code>。 |
| 逻辑 | <a href=logical_operators.md><code>or</code></a> | <code>x or y</code> | 短路逻辑或：如果任一操作数为 <code>true</code>，则为 <code>true</code>。 |
| 逻辑 | <a href=logical_operators.md><code>not</code></a> | <code>not x</code> | 逻辑非：如果操作数为 <code>false</code>，则为 <code>true</code>。 |</p><p>二元算术和位运算操作符还有<a href=/docs/design/assignment.md>复合赋值</a>形式。这些是语句而不是表达式，并且不产生值。</p><h2 id=转换和类型转换>转换和类型转换<a hidden class=anchor aria-hidden=true href=#转换和类型转换>#</a></h2><p>当表达式出现在需要特定类型的表达式的上下文中时，将应用<a href=implicit_conversions.md>隐式转换</a>将表达式转换为目标类型。</p><p>表达式也可以使用<a href=as_expressions.md><code>as</code> 表达式</a>转换为特定类型。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>fn Bar(n: i32);
</span></span><span style=display:flex><span>fn Baz(n: i64) {
</span></span><span style=display:flex><span>  // OK，与 Bar(n as i32) 相同
</span></span><span style=display:flex><span>  Bar(n);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=if-表达式><code>if</code> 表达式<a hidden class=anchor aria-hidden=true href=#if-表达式>#</a></h2><p><a href=if.md><code>if</code> 表达式</a>在两个表达式之间进行选择。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>fn Run(args: Span(StringView)) {
</span></span><span style=display:flex><span>  var file: StringView = if args.size() &gt; 1 then args[1] else &#34;/dev/stdin&#34;;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p><code>if</code> 表达式与 C 和 C++ 中的 <code>?:</code> 三元表达式类似。</p><h2 id=数值类型文字表达式>数值类型文字表达式<a hidden class=anchor aria-hidden=true href=#数值类型文字表达式>#</a></h2><p>Carbon 的语法提供了一种简单的方法来表示不同类型的整数和浮点数。每种类型都用类似关键字的语法标识，前缀为 <code>i</code>、<code>u</code> 或 <code>f</code>，后跟 8 的倍数，表示数据类型的位大小。</p><p>这些被称为<a href=literals.md#numeric-type-literals>数值类型文字</a>。</p><h2 id=考虑的替代方案>考虑的替代方案<a hidden class=anchor aria-hidden=true href=#考虑的替代方案>#</a></h2><p>其他表达式文档将列出更多的替代方案；此处列出的替代方案在其他地方没有提及。</p><ul><li><a href=/proposals/p0555.md#total-order>总顺序</a></li><li><a href=/proposals/p0555.md#different-precedence-for-different-operands>不同操作数的不同优先级</a></li><li><a href=/proposals/p0555.md#require-less-than-a-partial-order>要求少于部分顺序</a></li></ul><h2 id=参考文献>参考文献<a hidden class=anchor aria-hidden=true href=#参考文献>#</a></h2><p>其他表达式文档将列出更多的参考文献；此处列出的参考文献在其他地方没有提及。</p><ul><li>提案
<a href=https://github.com/carbon-language/carbon-lang/pull/555>#555: 操作符优先级</a>。</li></ul><p>这是使用 markdown 输出格式的中文全文翻译。您还想知道什么？</p><div class=mermaid>%%{init: {'themeVariables': {'fontFamily': 'monospace'}}}%%
graph BT
parens["(...)"]
braces["{...}"]
click braces "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/classes.md#literals"
unqualifiedName["x"]
click unqualifiedName "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/README.md#unqualified-names"
top((" "))
memberAccess>"x.y<br>x.(...)<br>x->y<br>x->(...)"]
click memberAccess "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/member_access.md"
constType["const T"]
click pointer-type "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/type_operators.md"
pointerType{"T*"}
click pointer-type "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/type_operators.md"
pointer{"*x<br>&x<br>"}
click pointer "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/pointer.md"
negation["-x"]
click negation "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/arithmetic.md"
complement["^x"]
click complement "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/bitwise.md"
incDec["++x;<br>--x;"]
click incDec "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/assignment.md"
unary((" "))
as["x as T"]
click as "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/implicit_conversions.md"
multiplication>"x * y<br>x / y"]
click multiplication "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/arithmetic.md"
addition>"x + y<br>x - y"]
click addition "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/arithmetic.md"
modulo["x % y"]
click modulo "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/arithmetic.md"
bitwise_and>"x & y"]
    bitwise_or>"x | y"]
    bitwise_xor>"x ^ y"]
click bitwise_and "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/bitwise.md"
click bitwise_or "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/bitwise.md"
click bitwise_xor "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/bitwise.md"
shift["x << y<br>x >> y"]
click shift "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/bitwise.md"
comparison["x == y<br>x != y<br>x < y<br>x <= y<br>x > y<br>x >= y"]
click comparison "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/comparison_operators.md"
not["not x"]
click not "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/logical_operators.md"
logicalOperand((" "))
and>"x and y"]
click and "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/logical_operators.md"
or>"x or y"]
click or "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/logical_operators.md"
logicalExpression((" "))
if>"if x then y else z"]
click if "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/expressions/if.md"
insideParens["(...)"]
assignment["x = y;<br>x $= y;"]
click assignment "https://github.com/carbon-language/carbon-lang/blob/trunk/docs/design/assignment.md"
expressionStatement["x;"]
top --> parens & braces & unqualifiedName

    constType --> top
pointerType --> constType
as --> pointerType
memberAccess --> top
pointer --> memberAccess
negation & complement & incDec --> pointer
 unary --> negation & complement
    %% Use a longer arrow here to put `not` next to `and` and `or`.
not -------> memberAccess
as & multiplication & modulo & bitwise_and & bitwise_or & bitwise_xor & shift --> unary
addition --> multiplication
comparison --> as & addition & modulo & bitwise_and & bitwise_or & bitwise_xor & shift
logicalOperand --> comparison & not
    and & or --> logicalOperand
logicalExpression --> and & or
    if & expressionStatement --> logicalExpression
insideParens & assignment --> if
</div></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://canftin.github.io/posts/tech/p9_compiler_build_8_parse_tree/><span class=title>« Prev</span><br><span>从零构造现代语言编译器(8): 解析树</span></a>
<a class=next href=https://canftin.github.io/posts/tech/p7_compiler_build_6_parse_node_state/><span class=title>Next »</span><br><span>从零构造现代语言编译器(6): Parse节点和状态</span></a></nav></footer></article></main><footer class=footer><span>Copyright
&copy;
2016-2023
<a href=https://github.com/canftin style=color:#939393>CanftIn</a>
, 许可协议：<a class=link href=https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-ND 4.0</a>,</span>
<span id=busuanzi_container><span class="fa fa-user"></span> <span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye"></span> <span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function n(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)})})</script></body></html>